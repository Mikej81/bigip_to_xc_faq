<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="F5 BIG-IP to Distributed Cloud Conversion Guide and Tips" name="description" />
<meta content="BIG-IP, Conversion, Distributed Cloud, WAAP, API, Proxy Protocol" name="keywords" />

    <title>BIG-IP To Distributed Cloud Conversion Frequently Asked Questions and Tips &#8212; BIG-IP to XC 2024 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css?v=0f882399" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <script src="_static/documentation_options.js?v=6fefd858"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="#">BIG-IP to XC 2024 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">BIG-IP To Distributed Cloud Conversion Frequently Asked Questions and Tips</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="big-ip-to-distributed-cloud-conversion-frequently-asked-questions-and-tips">
<h1>BIG-IP To Distributed Cloud Conversion Frequently Asked Questions and Tips<a class="headerlink" href="#big-ip-to-distributed-cloud-conversion-frequently-asked-questions-and-tips" title="Link to this heading">¶</a></h1>
</section>
<section id="disclaimer">
<span id="id1"></span><h1>Disclaimer<a class="headerlink" href="#disclaimer" title="Link to this heading">¶</a></h1>
<p>Please note that this FAQ document is intended as a general guide and is not exhaustive.
While we strive to provide accurate and up-to-date information, the rapidly evolving nature of
F5 Distributed Cloud means that specific details may change over time. Therefore, this guide
should not be considered a substitute for professional advice or detailed consultation relevant
to your specific circumstances.</p>
</section>
<section id="introduction">
<span id="id2"></span><h1>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h1>
<p>This semi-comprehensive guide is designed to streamline your migration from F5 BIG-IP to F5 Distributed Cloud.
This document aims to address frequently asked questions that arise during the migration process, offering clear,
concise answers and practical insights to ensure a smooth transition.</p>
</section>
<section id="contributing">
<h1>Contributing<a class="headerlink" href="#contributing" title="Link to this heading">¶</a></h1>
<p>Please feel free to submit issues or updates to the repo listed below.</p>
<p>Github: <a class="reference external" href="https://github.com/Mikej81/bigip_to_xc_faq">https://github.com/Mikej81/bigip_to_xc_faq</a></p>
</section>
<section id="disqualifiers">
<span id="id3"></span><h1>Disqualifiers<a class="headerlink" href="#disqualifiers" title="Link to this heading">¶</a></h1>
<p>This is a list of use-cases that can be used to immediately disqualify a migration, with some caveats.
There are service chaining use-cases that could still work, or ways to implement policies to redirect
traffic to a BIG-IP instead of XC, or ways to inline NGINX into XC to carry out many of the same effects.</p>
<ol class="arabic">
<li><p>Access services that require Match Across.  <a class="reference external" href="https://my.f5.com/manage/s/article/K5837">https://my.f5.com/manage/s/article/K5837</a></p>
<ul class="simple">
<li><p>DTLS - SSLVPN</p></li>
<li><p>PCOIP - (HTML5 BLAST works fine)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Most VPN Providers allow you to disable UDP/DTLS and force TCP, this works fine.</p>
</div>
</li>
<li><p>NTLM</p></li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>With the deprecation of NTLM Announced by Microsoft, it is recommend that all customers move to Kerberos, if at all possible.</p>
</div>
</section>
<section id="tools">
<h1>Tools<a class="headerlink" href="#tools" title="Link to this heading">¶</a></h1>
<p>The following are tools available to use today.  It’s important to note that none of these tools are 100%. It is highly recommended to work with an XC Specialist to help in migration from other platforms to XC.</p>
<ul class="simple">
<li><p>iHealth: <a class="reference external" href="https://ihealth2.f5.com/">iHealth</a></p></li>
<li><p>VS Code Extension: <a class="reference external" href="https://marketplace.visualstudio.com/items?itemName=F5DevCentral.vscode-f5">VS Code Extension</a>
- <a class="reference external" href="https://marketplace.visualstudio.com/items?itemName=F5DevCentral.vscode-f5">VS Code Extension Diagnostics</a></p></li>
<li><p>Policy Supervisor: <a class="reference external" href="https://policysupervisor.io/">Policy Supervisor</a></p></li>
<li><p>BIND to XC Conversion tool: <a class="reference external" href="https://github.com/Mikej81/BINDtoXCDNS">BIND to XC Conversion tool</a></p></li>
<li><p>Domain Keep-Alive Analyzer: <a class="reference external" href="https://keepalive.f5-sa.myedgedemo.com/">Domain Keep-Alive Analyzer</a></p></li>
</ul>
</section>
<section id="access-policy-manager">
<h1>Access Policy Manager<a class="headerlink" href="#access-policy-manager" title="Link to this heading">¶</a></h1>
<p>APM services are not supported in Distrubuted Cloud today, but Service/Proxy chaining is supported.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are some workable use-cases around Federated Authentication and proxy/service chaining.</p>
</div>
</section>
<section id="awaf-to-waap">
<h1>AWAF to WAAP<a class="headerlink" href="#awaf-to-waap" title="Link to this heading">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While we understand that some organizations have spend years, and even decades tuning a WAF policy, the recommended best practice when moving to Distributed Cloud WAAP is to start with the default recommendations, and tune from there.
Service Policies will cover traditional IP blocks as well as additional IP-Geo, and additional allow/deny rules.</p>
</div>
<p>Web Application Firewalls (WAF) originally emerged to protect web applications by filtering and monitoring HTTP traffic between a web application and the Internet. WAFs primarily focus on defending against common web attacks such as SQL injection, cross-site scripting (XSS), and file inclusion, operating according to a set of predefined or customizable rules.</p>
<p>The evolution to Web Application and API Protection (WAAP) represents a shift towards a more comprehensive security framework that not only includes all the traditional protections offered by WAFs but also extends coverage to APIs, which are increasingly used as the backbone of modern applications.</p>
<p>Be sure to evaluate ASM Logs for WAF activity to determing which, if any policies need to be migrated.</p>
<a class="reference internal image-reference" href="_images/picture17.png"><img alt="_images/picture17.png" class="align-center" src="_images/picture17.png" style="width: 700px;" />
</a>
<p>Check ASM Logs for activity.</p>
<p>The best way to streamline the AWAF to XC WAAP policy is to use Policy Supervisor.</p>
<section id="bot-defense">
<h2>Bot Defense<a class="headerlink" href="#bot-defense" title="Link to this heading">¶</a></h2>
<p>Bot Defense is likely to require XC Bot Defense Standard at a minimum, or Advanced. XC WAAP contains only Bot Signatures. A simple alternative could be XC JavaScript Challenge, which might not meet your security requirements.</p>
</section>
<section id="id4">
<h2>Policy Supervisor<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<p>Policy Supervisor can be used to convert BIG-IP Adv. WAF policies to XC WAF policies.</p>
<p>If you do not have access to Policy Supervisor, you should check out the guidance here:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://f5.sharepoint.com/sites/salesandmktg/sales/SecurityMarketing">https://f5.sharepoint.com/sites/salesandmktg/sales/SecurityMarketing</a></p></li>
<li><p><a class="reference external" href="https://github.com/f5devcentral/ps-convert">https://github.com/f5devcentral/ps-convert</a></p></li>
<li><p><a class="reference external" href="https://policysupervisor.io/">https://policysupervisor.io/</a></p></li>
<li><p><a class="reference external" href="https://policysupervisor.io/convert">https://policysupervisor.io/convert</a></p></li>
</ul>
<a class="reference internal image-reference" href="_images/picture18.png"><img alt="_images/picture18.png" class="align-center" src="_images/picture18.png" style="width: 700px;" />
</a>
</div></blockquote>
</section>
</section>
<section id="local-traffic-manager">
<h1>Local Traffic Manager<a class="headerlink" href="#local-traffic-manager" title="Link to this heading">¶</a></h1>
<p>There are very few disqualifiers for LTM.</p>
<ol class="arabic simple">
<li><p>Load Balancing services that require Match Across.</p>
<ul class="simple">
<li><p>DTLS</p></li>
<li><p>PCOIP</p></li>
</ul>
</li>
<li><p>Streaming Profiles. We do not support streaming content today in XC LBs.</p>
<ul class="simple">
<li><p>E.g., Rewriting HTML page content.</p></li>
</ul>
</li>
<li><p>OneConnect</p></li>
</ol>
</section>
<section id="dns">
<h1>DNS<a class="headerlink" href="#dns" title="Link to this heading">¶</a></h1>
<p>Distributed Cloud DNS supports Primary, Secondary, and DNS Load Balancing.  The base format for zones is JSON/YAML, and in some cases cannot be directly imported.</p>
<p>For BIG-IP DNS Wide IP configurations, there is not an automated way to migrate today, so this will be a manual process.</p>
<section id="big-ip-dns-pool-to-xc-dns-lb-pool">
<h2>BIG-IP DNS Pool to XC DNS LB Pool<a class="headerlink" href="#big-ip-dns-pool-to-xc-dns-lb-pool" title="Link to this heading">¶</a></h2>
<p>This will be a very small example of a manual migration to XC.  As we can see below from the output of <code class="docutils literal notranslate"><span class="pre">`list</span> <span class="pre">gtm</span> <span class="pre">pool`</span></code> we have two pools with single members.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gtm</span> <span class="n">pool</span> <span class="n">a</span> <span class="n">pool1</span> <span class="p">{</span>
    <span class="n">members</span> <span class="p">{</span>
        <span class="n">BIG</span><span class="o">-</span><span class="n">IPVE16</span><span class="o">-</span><span class="n">A</span><span class="o">.</span><span class="n">local</span><span class="p">:</span><span class="o">/</span><span class="n">Common</span><span class="o">/</span><span class="n">vip1</span> <span class="p">{</span>
            <span class="n">member</span><span class="o">-</span><span class="n">order</span> <span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">gtm</span> <span class="n">pool</span> <span class="n">a</span> <span class="n">pool2</span> <span class="p">{</span>
    <span class="n">members</span> <span class="p">{</span>
        <span class="n">BIG</span><span class="o">-</span><span class="n">IPVE16</span><span class="o">-</span><span class="n">A</span><span class="o">.</span><span class="n">local</span><span class="p">:</span><span class="o">/</span><span class="n">Common</span><span class="o">/</span><span class="n">vip2</span> <span class="p">{</span>
            <span class="n">member</span><span class="o">-</span><span class="n">order</span> <span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can see how pool1 would map to XC DNS LB Pool in the figure below.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/dns1.png"><img alt="_images/dns1.png" src="_images/dns1.png" style="width: 700px;" />
</a>
</figure>
</section>
<section id="big-ip-dns-wide-ip-to-xc-dns-lb-record">
<h2>BIG-IP DNS Wide IP to XC DNS LB Record<a class="headerlink" href="#big-ip-dns-wide-ip-to-xc-dns-lb-record" title="Link to this heading">¶</a></h2>
<p>As we can see below from the output of <code class="docutils literal notranslate"><span class="pre">`list</span> <span class="pre">gtm</span> <span class="pre">wideip`</span></code> we have one Wide-IP with two pools.  There arent any rules here to dig in to, but those can be configured in XC as needed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gtm</span> <span class="n">wideip</span> <span class="n">a</span> <span class="n">example</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">com</span> <span class="p">{</span>
    <span class="n">pools</span> <span class="p">{</span>
        <span class="n">pool1</span> <span class="p">{</span>
            <span class="n">order</span> <span class="mi">0</span>
        <span class="p">}</span>
        <span class="n">pool2</span> <span class="p">{</span>
            <span class="n">order</span> <span class="mi">1</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can see how the Wide-IP for example.domain.com would map to XC in the figure below.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/dns2.png"><img alt="_images/dns2.png" src="_images/dns2.png" style="width: 700px;" />
</a>
</figure>
</section>
<section id="zonerunner-dnsexpress">
<h2>Zonerunner &amp; DNSExpress<a class="headerlink" href="#zonerunner-dnsexpress" title="Link to this heading">¶</a></h2>
<p>For BIG-IP DNS Host Zones, it is possible to migrate a couple ways.</p>
<ul class="simple">
<li><p>The named files which can be imported into F5 Distributed Cloud DNS.</p>
<ul>
<li><p>You can follow instructions Here:  <a class="reference external" href="https://my.f5.com/manage/s/article/K000132496">https://my.f5.com/manage/s/article/K000132496</a></p></li>
</ul>
</li>
<li><p>If you plan to maintain the BIG-IP DNS as Primary, and use Distributed Cloud as Secondary, AXFR is supported.</p>
<ul>
<li><p>You can follow instructions here:  <a class="reference external" href="https://f5cloud.zendesk.com/hc/en-us/articles/7980850576535-How-to-set-up-F5-Distributed-Cloud-DNS-as-Secondary-for-BIG-IP-DNS-GTM">https://f5cloud.zendesk.com/hc/en-us/articles/7980850576535-How-to-set-up-F5-Distributed-Cloud-DNS-as-Secondary-for-BIG-IP-DNS-GTM</a></p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since this document is focused on BIG-IP to Distributed Cloud, BIND import is out of scope, but importing named/BIND9 zone files is also supported.</p>
</div>
</section>
</section>
<section id="apm-to-distributed-cloud-service-chaining">
<h1>APM to Distributed Cloud (Service Chaining)<a class="headerlink" href="#apm-to-distributed-cloud-service-chaining" title="Link to this heading">¶</a></h1>
<p>We covered the disqualifiers, but there are some that will work fine, like service chaining for Federation, or header validation.</p>
<section id="api-security">
<h2>API Security<a class="headerlink" href="#api-security" title="Link to this heading">¶</a></h2>
<p>One of the major differences in API security between BIG-IP and Distributed Cloud is the addition of API Discovery.  Today, the policies from BIG-IP will not transfer.  However,
if the current implemention utilized an OpenAPI Spec, that spec can be imported into Distributed Cloud.</p>
</section>
</section>
<section id="ltm-to-load-balancing-as-a-service">
<h1>LTM to Load Balancing as a Service<a class="headerlink" href="#ltm-to-load-balancing-as-a-service" title="Link to this heading">¶</a></h1>
<p>Most services will move to Distributed Cloud fairly easily.</p>
<section id="tcp-option-28-and-proxy-protocol">
<h2>TCP Option 28 and Proxy Protocol<a class="headerlink" href="#tcp-option-28-and-proxy-protocol" title="Link to this heading">¶</a></h2>
<p>While the BIG-IP supports TCP Option 28 to maintain client source ip, due to never making it out of experimental, Distributed cloud went with Proxy Protocol.  This can
be configured under Distributed Cloud Origin Pool Settings.</p>
<figure class="align-center" id="id10">
<a class="reference internal image-reference" href="_images/proxyprotocol1.png"><img alt="_images/proxyprotocol1.png" src="_images/proxyprotocol1.png" style="width: 500px;" />
</a>
<figcaption>
<p><span class="caption-text">Origin Pool Miscellaneous Config.</span><a class="headerlink" href="#id10" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="websockets">
<h2>Websockets<a class="headerlink" href="#websockets" title="Link to this heading">¶</a></h2>
<p>Websockets are supported for load balancing in Distributed Cloud.</p>
<p><a class="reference external" href="https://f5cloud.zendesk.com/hc/en-us/articles/18944650914327-How-to-configure-Websockets-correctly-on-F5-XC-platform">https://f5cloud.zendesk.com/hc/en-us/articles/18944650914327-How-to-configure-Websockets-correctly-on-F5-XC-platform</a></p>
</section>
<section id="ltm-as-upstream-origin">
<h2>LTM as Upstream / Origin<a class="headerlink" href="#ltm-as-upstream-origin" title="Link to this heading">¶</a></h2>
<p>Occasionally there is a use-case where instead of a Customer Edge on-premises, you want to continue to use a BIG-IP.  This will work,
as long as proper preparations are made.  In many situations there may be custom (or even using default) TCP and HTTP Profiles which can be
problematic when moving to a SaaS based solution.</p>
<section id="http-1-1-http-2">
<h3>HTTP/1.1 &amp; HTTP/2<a class="headerlink" href="#http-1-1-http-2" title="Link to this heading">¶</a></h3>
<p>BIG-IP by default uses HTTP/1.1 on profiles.  Distributed Cloud uses HTTP/2 by default.  It is important to ensure that the Origin Pool in XC is configured for HTTP/1.1 when the Upstream is a BIG-IP.</p>
</section>
<section id="http-keep-alive-connection-headers">
<h3>HTTP Keep-Alive &amp; Connection Headers<a class="headerlink" href="#http-keep-alive-connection-headers" title="Link to this heading">¶</a></h3>
<p>The Keep-Alive general header allows the sender to hint about how the connection may be used to set a timeout and a maximum amount of requests.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Connection-specific header fields such as Connection and Keep-Alive are prohibited in HTTP/2 and HTTP/3. Chrome and Firefox ignore them in HTTP/2 responses, but Safari conforms to the HTTP/2 specification requirements and does not load any response that contains them.</p>
</div>
<p>Since keep-alive and connection headers will be ignored, its important to evaluate timeouts from XC to BIG-IP and properly configure timeouts in the Load Balancer and Origin configurations.</p>
<p>Timeouts can be configured in a a number of locations in the XC Console.</p>
<figure class="align-center" id="id11">
<a class="reference internal image-reference" href="_images/lb_timeout.png"><img alt="_images/lb_timeout.png" src="_images/lb_timeout.png" style="width: 500px;" />
</a>
<figcaption>
<p><span class="caption-text">Load Balancer Timeout.</span><a class="headerlink" href="#id11" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id12">
<a class="reference internal image-reference" href="_images/route_timeout.png"><img alt="_images/route_timeout.png" src="_images/route_timeout.png" style="width: 500px;" />
</a>
<figcaption>
<p><span class="caption-text">Route Timeout.</span><a class="headerlink" href="#id12" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id13">
<a class="reference internal image-reference" href="_images/origin_timeout.png"><img alt="_images/origin_timeout.png" src="_images/origin_timeout.png" style="width: 500px;" />
</a>
<figcaption>
<p><span class="caption-text">Origin Timeout.</span><a class="headerlink" href="#id13" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="monitors-to-health-checks">
<h3>Monitors to Health Checks<a class="headerlink" href="#monitors-to-health-checks" title="Link to this heading">¶</a></h3>
<p>If the Upstream (Origin Server) is still using HTTP/1.1 or is a BIG-IP using HTTP/1.1, then it may be a good idea to include the previously
mentioned Connection header. The Connection general header controls whether the network connection stays open after the current transaction finishes.
If the value sent is keep-alive, the connection is persistent and not closed, allowing for subsequent requests to the same server to be done.
Since this is for a Monitor/Health Check, its a good practice to close the connection. An example of the JSON you can paste into XC is below.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;example&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;disable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="p">},</span>
<span class="nt">&quot;spec&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;http_health_check&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;use_origin_server_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">   </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;use_http2&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;headers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Connection&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Close&quot;</span>
<span class="w">   </span><span class="p">},</span>
<span class="w">   </span><span class="nt">&quot;expected_status_codes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;200&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;302&quot;</span>
<span class="w">   </span><span class="p">]</span>
<span class="w">   </span><span class="p">},</span>
<span class="w">   </span><span class="nt">&quot;timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;unhealthy_threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;healthy_threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;jitter_percent&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is just an example and should be modified for specific scenarios.</p>
</section>
<section id="snat">
<h3>SNAT<a class="headerlink" href="#snat" title="Link to this heading">¶</a></h3>
<p>Distributed Cloud is a SaaS Platform.  BIG-IP is not.  Some applications may be configured to accept client source for persistence or other purposes.  Since the traffic will be proxied, applications been to be enabled for a more modern approach.</p>
</section>
</section>
<section id="ltm-to-customer-edge">
<h2>LTM to Customer Edge<a class="headerlink" href="#ltm-to-customer-edge" title="Link to this heading">¶</a></h2>
<p>The following ports can not be used when advertising services on a Customer Edge.</p>
<table class="docutils align-default" id="id14">
<caption><span class="caption-text">Reserved Ports</span><a class="headerlink" href="#id14" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>22</p></td>
<td><p>53 <strong>Check Note</strong></p></td>
</tr>
<tr class="row-even"><td><p>68</p></td>
<td><p>323</p></td>
</tr>
<tr class="row-odd"><td><p>500</p></td>
<td><p>1067</p></td>
</tr>
<tr class="row-even"><td><p>2379</p></td>
<td><p>2380</p></td>
</tr>
<tr class="row-odd"><td><p>4500</p></td>
<td><p>5355</p></td>
</tr>
<tr class="row-even"><td><p>6443</p></td>
<td><p>8005</p></td>
</tr>
<tr class="row-odd"><td><p>8007</p></td>
<td><p>8087</p></td>
</tr>
<tr class="row-even"><td><p>8443</p></td>
<td><p>8444</p></td>
</tr>
<tr class="row-odd"><td><p>8505</p></td>
<td><p>8507</p></td>
</tr>
<tr class="row-even"><td><p>9007</p></td>
<td><p>9090</p></td>
</tr>
<tr class="row-odd"><td><p>9153</p></td>
<td><p>9999</p></td>
</tr>
<tr class="row-even"><td><p>10249</p></td>
<td><p>10250</p></td>
</tr>
<tr class="row-odd"><td><p>10251</p></td>
<td><p>10252</p></td>
</tr>
<tr class="row-even"><td><p>10256</p></td>
<td><p>10257</p></td>
</tr>
<tr class="row-odd"><td><p>10259</p></td>
<td><p>18091</p></td>
</tr>
<tr class="row-even"><td><p>18092</p></td>
<td><p>18093</p></td>
</tr>
<tr class="row-odd"><td><p>18095</p></td>
<td><p>22222</p></td>
</tr>
<tr class="row-even"><td><p>23790</p></td>
<td><p>23791</p></td>
</tr>
<tr class="row-odd"><td><p>23801</p></td>
<td><p>23802</p></td>
</tr>
<tr class="row-even"><td><p>28000 - 32767 (volterra)</p></td>
<td><p>28000 - 32767 (kubernetes)</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using a Custom VIP/IP on the Customer Edge, is is possible to advertise / listen on TCP/UDP 53.</p>
</div>
</section>
<section id="snat-pooling">
<h2>SNAT Pooling<a class="headerlink" href="#snat-pooling" title="Link to this heading">¶</a></h2>
<p>Today, XC does not support a traditional SNAT pool type configuration, however, you can scale SNAT based on nodes in a cluster.  So a 3 node cluster will have 3 IPs for SNATTING, if you need more SNAT IPs, then add more nodes.</p>
</section>
<section id="traffig-group-floating-self-ip">
<h2>Traffig Group / Floating Self-IP<a class="headerlink" href="#traffig-group-floating-self-ip" title="Link to this heading">¶</a></h2>
<p>To create the same scenario as a traffic group or floating self, you can use VRRP.  Check out Harmon’s article here, where he discusses some of the CE design scenarios.  <a class="reference external" href="https://community.f5.com/t5/technical-articles/f5-distributed-cloud-customer-edge-site-deployment-amp-routing/ta-p/319435">https://community.f5.com/t5/technical-articles/f5-distributed-cloud-customer-edge-site-deployment-amp-routing/ta-p/319435</a></p>
<p>A byproduct of enabling VRRP on your cluster, and creating a common VIP, is that you can also use that common VIP as a default gateway.</p>
<p>Refer to the Custoemr Edge section for additional details on VRRP and Multicast. <a class="reference internal" href="#clustering-and-high-availability">Clustering and High availability</a></p>
</section>
<section id="custom-monitors">
<h2>Custom Monitors<a class="headerlink" href="#custom-monitors" title="Link to this heading">¶</a></h2>
<p>If you have been relying on custom monitors for routine tasks such as backing up data to an FTP server, sending email reports, or generating alerts based on storage availability. With F5 Distributed Cloud (XC), many of these functions are seamlessly integrated, thanks to our SaaS platform’s built-in scheduled reporting and alert capabilities.</p>
<p>However, if you need to perform a specific task that isn’t currently supported by XC, such as invoking an API or executing a specialized function, we’ve got you covered. You can easily recreate this functionality in a small container script (for example, using bash) and deploy it as a scheduled task within our virtual Kubernetes environment.</p>
<p>For instance, if you need to activate a service policy or a network firewall rule at particular times each day, you can set up a cron job in XC. This job will operate on your schedule and interact with the XC API to execute your policies as planned.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CronJob</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">batch/v1beta1</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coleman-generic-restcurl</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restcurl</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cron</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ves.io/virtual-sites</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">m-coleman/coleman-ves-io-ny-re</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">schedule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;30</span><span class="nv"> </span><span class="s">10,20</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">1-5&quot;</span><span class="w"> </span><span class="c1"># Every weekday at 10:30, and 20:30 UTC</span>
<span class="w">  </span><span class="nt">jobTemplate</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restcurl</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cron</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">          </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">            </span><span class="nt">ves.io/workload-flavor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiny</span>
<span class="w">            </span><span class="nt">ves.io/virtual-sites</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">m-coleman/coleman-ves-io-ny-re</span>
<span class="w">        </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">          </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Never</span>
<span class="w">          </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">curl-worker</span>
<span class="w">              </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">curlimages/curl:latest</span>
<span class="w">              </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="w">              </span><span class="nt">env</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_URI</span>
<span class="w">                  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://&lt;tenant&gt;.console.ves.volterra.io/api/web/namespaces&quot;</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_TOKEN</span>
<span class="w">                  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;APIToken</span><span class="nv"> </span><span class="s">&lt;token</span><span class="nv"> </span><span class="s">value&gt;&quot;</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_METHOD</span>
<span class="w">                  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;POST&quot;</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_PAYLOAD</span>
<span class="w">                  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{&quot;metadata&quot;:</span><span class="nv"> </span><span class="s">{&quot;name&quot;:</span><span class="nv"> </span><span class="s">&quot;service-policy-1&quot;,&quot;namespace&quot;:</span><span class="nv"> </span><span class="s">&quot;namespace&quot;},</span><span class="nv"> </span><span class="s">&quot;spec&quot;:</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">&quot;deny_all_requests&quot;:</span><span class="nv"> </span><span class="s">{}</span><span class="nv"> </span><span class="s">}</span><span class="nv"> </span><span class="s">}&#39;</span>
<span class="w">              </span><span class="nt">command</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;/bin/sh&quot;</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-ec&quot;</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">                  </span><span class="no">set -o nounset</span>
<span class="w">                  </span><span class="no">set -o errexit</span>
<span class="w">                  </span><span class="no">echo &quot;API Call&quot;</span>
<span class="w">                  </span><span class="no">curl -s -X ${API_METHOD} -H &#39;Content-Type: application/json&#39; -H &quot;Authorization: ${API_TOKEN}&quot; &quot;${API_URI}&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="qkview-ihealth">
<h1>QKView - iHealth<a class="headerlink" href="#qkview-ihealth" title="Link to this heading">¶</a></h1>
<section id="graphs">
<h2>Graphs<a class="headerlink" href="#graphs" title="Link to this heading">¶</a></h2>
<section id="ssl-transactions">
<h3>SSL Transactions<a class="headerlink" href="#ssl-transactions" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="_images/picture3.png"><img alt="_images/picture3.png" class="align-center" src="_images/picture3.png" style="width: 700px;" />
</a>
</section>
<section id="tmm-client-side-throughput">
<h3>TMM Client-Side Throughput<a class="headerlink" href="#tmm-client-side-throughput" title="Link to this heading">¶</a></h3>
<p>The sum throughput of all Traffic Management Microkernel (TMM) and Packet Velocity ASIC (PVA) traffic on the client side. The following fields are represented in bits per second and packets per second:</p>
<blockquote>
<div><ul class="simple">
<li><p>Client In: The sum of all ingress traffic</p></li>
<li><p>Client Out: The sum of all egress traffic</p></li>
</ul>
</div></blockquote>
<a class="reference internal image-reference" href="_images/picture4.png"><img alt="_images/picture4.png" class="align-center" src="_images/picture4.png" style="width: 700px;" />
</a>
</section>
<section id="tmm-server-side-throughput">
<h3>TMM Server-Side Throughput<a class="headerlink" href="#tmm-server-side-throughput" title="Link to this heading">¶</a></h3>
<p>The sum throughput of all TMM and PVA traffic on the server side. The following fields are represented in bits per second and packets per second:</p>
<blockquote>
<div><ul class="simple">
<li><p>Server In: The sum of all egress traffic</p></li>
<li><p>Server Out: The sum of all ingress traffic</p></li>
</ul>
</div></blockquote>
<a class="reference internal image-reference" href="_images/picture5.png"><img alt="_images/picture5.png" class="align-center" src="_images/picture5.png" style="width: 700px;" />
</a>
</section>
<section id="throughput">
<h3>Throughput<a class="headerlink" href="#throughput" title="Link to this heading">¶</a></h3>
<p>The total throughput in and out of the BIG-IP system collected from all interfaces, including traffic processed by all Traffic Management Microkernel (TMM) and Packet Velocity ASIC (PVA), except the management interface. The following fields are represented in bits per second and packets per second:</p>
<blockquote>
<div><ul class="simple">
<li><p>In: The ingress traffic to the system through its interfaces</p></li>
<li><p>Out: The egress traffic from the system through its interfaces</p></li>
<li><p>Service: The larger of the two values of combined client and server-side ingress traffic or egress traffic, measured within TMM. You can compare this to VE-licensed bandwidth.</p></li>
</ul>
</div></blockquote>
<a class="reference internal image-reference" href="_images/picture6.png"><img alt="_images/picture6.png" class="align-center" src="_images/picture6.png" style="width: 700px;" />
</a>
</section>
</section>
<section id="irules">
<h2>iRules<a class="headerlink" href="#irules" title="Link to this heading">¶</a></h2>
<p>One of the first things to evaluate with irules, is if they are even being used. An effective way to gauge that is to check the Unused Objects under the Config Explorer. So, if you have 150 total irules, but are not using 102 of them, then that means we only need to review 48 irules, and based on historical evidence, I would estimate over 75% of those are just uncustomized redirect irules.</p>
<a class="reference internal image-reference" href="_images/picture7.png"><img alt="_images/picture7.png" class="align-center" src="_images/picture7.png" style="width: 700px;" />
</a>
<p>You can also see in the specific irules how many times its even executed (if its attached) under the irules Statistics.</p>
<a class="reference internal image-reference" href="_images/picture8.png"><img alt="_images/picture8.png" class="align-center" src="_images/picture8.png" style="width: 500px;" />
</a>
<a class="reference internal image-reference" href="_images/picture8-a.png"><img alt="_images/picture8-a.png" class="align-center" src="_images/picture8-a.png" style="width: 500px;" />
</a>
</section>
<section id="commands">
<h2>Commands<a class="headerlink" href="#commands" title="Link to this heading">¶</a></h2>
<section id="list-ltm-virtual-all-properties">
<h3>list /ltm virtual all-properties<a class="headerlink" href="#list-ltm-virtual-all-properties" title="Link to this heading">¶</a></h3>
<p>A straightforward way, other than reviewing the bigip.conf is to use the list /ltm virtual all-properties command and then search for “rules {”.</p>
<p>IRules that can be ignored because it’s a checkbox choice in XC are redirects:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>rules {
     /Common/_sys_https_redirect
}
</pre></div>
</div>
<p>In the example QKView I am using, there are 670 instances of “rules”, and 468 instances of “/Common/_sys_https_redirect”. So, we have 202 instances of potential irules to evaluate, which is still pretty high.  But if we look at the irules, many customers have built custom redirects, which we can potentially ignore as well once we see they are just redirects.</p>
<p>Let’s look at an irule example, we can see it’s in use, and has had 34k executions in the past 30 days. I’m sure someone will argue the point, but this is still a redirect irule. Or you could call it an apology page. It’s setting the default pool, and if there aren’t any active members, sending it to another page.</p>
<a class="reference internal image-reference" href="_images/picture10.png"><img alt="_images/picture10.png" class="align-center" src="_images/picture10.png" style="width: 700px;" />
</a>
<p>This is extremely easy to do with just L7 Routes, and custom error pages.</p>
<p>In this qkview, there are mostly custom redirect irules based on host headers, over and over again.  This is a manual process, so be prepared to see a lot of redirects.</p>
<a class="reference internal image-reference" href="_images/picture11.png"><img alt="_images/picture11.png" class="align-center" src="_images/picture11.png" style="width: 700px;" />
</a>
<p>Then be prepared to see a ton of custom logging or header injections. Header Insert, Removal, and Appending can be easily done with the Load Balancer Advanced config, or more granularly via the L7 Route configs.</p>
<p>In the case of this irule, it’s just going to insert the header on every HTTP REQUEST. This is managed at the top-level Load Balancer Configs under More Options.</p>
<a class="reference internal image-reference" href="_images/picture12.png"><img alt="_images/picture12.png" class="align-center" src="_images/picture12.png" style="width: 700px;" />
</a>
<p>From there you can add and remove headers to your heart’s content.</p>
<a class="reference internal image-reference" href="_images/picture13.png"><img alt="_images/picture13.png" class="align-center" src="_images/picture13.png" style="width: 700px;" />
</a>
<p>If this irule had more logic, IF host header = this.domain.com, then we would use the L7 Route options.</p>
<a class="reference internal image-reference" href="_images/picture14.png"><img alt="_images/picture14.png" class="align-center" src="_images/picture14.png" style="width: 700px;" />
</a>
</section>
<section id="show-ltm-profile-http-global">
<h3>show /ltm profile http global<a class="headerlink" href="#show-ltm-profile-http-global" title="Link to this heading">¶</a></h3>
<p>This command will give you a quick snapshot of traffic with a virtual server with an associated HTTP profile.</p>
<a class="reference internal image-reference" href="_images/picture1.png"><img alt="_images/picture1.png" class="align-center" src="_images/picture1.png" style="width: 700px;" />
</a>
<p>We can see that we have had about 532 million requests across all virtual servers (over the last 30 days in this example). We can also see that there were about 71 million redirects.</p>
<p>This data is perfect if we are evaluating an API use-case.</p>
</section>
</section>
<section id="unix-tmos-tmctl-a-blade">
<h2>UNIX - TMOS - tmctl -a (blade)<a class="headerlink" href="#unix-tmos-tmctl-a-blade" title="Link to this heading">¶</a></h2>
<p>This gets us to the TMSTATS collections that span usually beyond the last 30 days that the RRD Graphs might show. Scroll down to the profile_http link and click it. This will give the aggregate values as well as every individual virtual server with a HTTP profile in a table format with column headers that are clickable to sort the data based on the values. Within this you will also reveal where some dormant virtuals are that do not need to be considered for migrations.</p>
<a class="reference internal image-reference" href="_images/picture9.png"><img alt="_images/picture9.png" class="align-center" src="_images/picture9.png" style="width: 700px;" />
</a>
</section>
</section>
<section id="id5">
<h1>iRules<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h1>
<p>If not clear, any irules that are performing redirects, header additions, rewrites, or appending values are easily migrated to L7 Routes. If the irules requires things like binary scan, that is something XC does not support today.</p>
<p>IRules that focus on Access Control based on evaluating IP blocks, client source addresses, etc., are easily migrated to Service Policies.</p>
<section id="rule-init">
<h2>RULE_INIT<a class="headerlink" href="#rule-init" title="Link to this heading">¶</a></h2>
<p>RULE_INIT is generally used to set some static variables for use in the rest of the irule, since we don’t have any programming logic in XC in order to take advantage of this, it can generally be thrown out, but pay attention to any definitions of data groups or things like that so you can understand the irules purpose; is it pulling domain names, is it pulling client ips, etc.</p>
</section>
<section id="client-accepted">
<h2>CLIENT_ACCEPTED<a class="headerlink" href="#client-accepted" title="Link to this heading">¶</a></h2>
<p>Depending on what is happening during CLIENT_ACCEPTED this event may not be needed, or if there is some complex action requirements it will not be a good possibility for porting. Most customers use this to log client ip/prefix data, or select a pool based on an identifying client attribute, this can be done via L7 Routes.</p>
</section>
<section id="clientssl-clientcert">
<h2>CLIENTSSL_CLIENTCERT<a class="headerlink" href="#clientssl-clientcert" title="Link to this heading">¶</a></h2>
<p>This event is probably not as common outside of mTLS use-cases, and in many cases is just used for logging, but also commonly used to create SSL Session ID’s for Persistence use-cases. While XC does not support SSL Session ID persistence today, it does support mTLS, and it can extract the X.509 attributes and inject into headers to use for similar purposes.</p>
<p>If we evaluate the following example:</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="nv">when</span><span class="w"> </span>CLIENTSSL_CLIENTCERT<span class="w"> </span><span class="k">{</span>
<span class="w">   </span><span class="k">set</span><span class="w"> </span>cert<span class="w"> </span><span class="k">[</span><span class="nv">SSL</span><span class="o">::</span>cert<span class="w"> </span><span class="mi">0</span><span class="k">]</span>
<span class="w">   </span><span class="c"># Save the cert fields to a list</span>
<span class="w">   </span><span class="k">set</span><span class="w"> </span>fields<span class="w"> </span><span class="k">[</span><span class="nv">X509</span><span class="o">::</span>cert_fields<span class="w"> </span><span class="nv">$cert</span><span class="w"> </span><span class="k">[</span><span class="nv">SSL</span><span class="o">::</span>verify_result<span class="k">]</span><span class="w"> </span>hash<span class="w"> </span>issuer<span class="w"> </span>serial<span class="w"> </span>sigalg<span class="w"> </span>subject<span class="w"> </span>subpubkey<span class="w"> </span>validity<span class="w"> </span>versionnum<span class="w"> </span>whole<span class="k">]</span>
<span class="w">   </span><span class="nv">log</span><span class="w"> </span>local0.<span class="w"> </span><span class="s2">&quot;Client certificate fields - $fields&quot;</span>
<span class="w">   </span><span class="c"># Add the cert to the session table for use in subsequent HTTP requests.  Use the SSL session ID as the key.</span>
<span class="w">   </span><span class="nv">session</span><span class="w"> </span>add<span class="w"> </span>ssl<span class="w"> </span><span class="k">[</span><span class="nv">SSL</span><span class="o">::</span>sessionid<span class="k">]</span><span class="w"> </span><span class="k">[</span><span class="nb">list</span><span class="w"> </span><span class="nv">$cert</span><span class="w"> </span><span class="nv">$fields</span><span class="k">]</span><span class="w"> </span><span class="nv">$::session_timeout</span>
<span class="k">}</span>
</pre></div>
</div>
<p>We can use mTLS configuration to extract the X.509 Values.</p>
<a class="reference internal image-reference" href="_images/picture15.png"><img alt="_images/picture15.png" class="align-center" src="_images/picture15.png" style="width: 700px;" />
</a>
<p>Which we can then use for logic in the L7 routes.</p>
</section>
<section id="lb-selected-lb-failed">
<h2>LB_SELECTED &amp; LB_FAILED<a class="headerlink" href="#lb-selected-lb-failed" title="Link to this heading">¶</a></h2>
<p>Depending on the use-case here, it’s possible that we can supply simple solutions in XC to match functionality. Are you sending an apology page, are you redirecting, etc.</p>
</section>
<section id="http-request">
<h2>HTTP_REQUEST<a class="headerlink" href="#http-request" title="Link to this heading">¶</a></h2>
<p>Depending on what is happening here, most irules are easily portable to L7 routes, excluding any collection or streaming. Setting, removing, and appending HTTP Headers can be carried out in several ways, including AND/OR logic for modification.</p>
<p>Matching Host Header and URI Path Example using L7 Route Configs:</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="nv">when</span><span class="w"> </span>HTTP_REQUEST<span class="w"> </span><span class="k">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="k">{</span><span class="w"> </span><span class="k">([</span><span class="nb">string</span><span class="w"> </span>tolower<span class="w"> </span><span class="k">[</span><span class="nv">HTTP</span><span class="o">::</span>host<span class="k">]]</span><span class="w"> </span><span class="nv">equals</span><span class="w"> </span><span class="s2">&quot;domain.com&quot;</span><span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">[</span><span class="nv">HTTP</span><span class="o">::</span>uri<span class="k">]</span><span class="w"> </span><span class="nv">starts_with</span><span class="w"> </span><span class="s2">&quot;/xyz&quot;</span><span class="w"> </span><span class="k">}</span><span class="w"> </span><span class="k">{</span>
<span class="w">    </span><span class="nv">node</span><span class="w"> </span><span class="mf">1.1</span>.1.1<span class="w"> </span><span class="mi">443</span>
<span class="w">  </span><span class="k">}</span>
<span class="k">}</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/http_request_1.png"><img alt="_images/http_request_1.png" class="align-center" src="_images/http_request_1.png" style="width: 700px;" />
</a>
<p>If the irule also does Host rewrites to the upstream, or path rewriting, this is also done with L7 Route configs.</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="nv">when</span><span class="w"> </span>HTTP_REQUEST<span class="w"> </span><span class="k">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="k">{</span><span class="w"> </span><span class="k">([</span><span class="nb">string</span><span class="w"> </span>tolower<span class="w"> </span><span class="k">[</span><span class="nv">HTTP</span><span class="o">::</span>host<span class="k">]]</span><span class="w"> </span><span class="nv">equals</span><span class="w"> </span><span class="s2">&quot;domain.com&quot;</span><span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">[</span><span class="nv">HTTP</span><span class="o">::</span>uri<span class="k">]</span><span class="w"> </span><span class="nv">starts_with</span><span class="w"> </span><span class="s2">&quot;/xyz&quot;</span><span class="w"> </span><span class="k">}</span><span class="w"> </span><span class="k">{</span>
<span class="w">    </span><span class="c"># Rewrite the host header</span>
<span class="w">    </span><span class="nv">HTTP</span><span class="o">::</span>host<span class="w"> </span><span class="s2">&quot;app1.domain.com&quot;</span>

<span class="w">    </span><span class="c"># Rewrite the URI path from /xyz to /lmn</span>
<span class="w">    </span><span class="nv">HTTP</span><span class="o">::</span>uri<span class="w"> </span><span class="k">[</span><span class="nb">string</span><span class="w"> </span>map<span class="w"> </span><span class="k">{</span><span class="s2">&quot;/xyz&quot;</span><span class="w"> </span><span class="s2">&quot;/lmn&quot;</span><span class="k">}</span><span class="w"> </span><span class="k">[</span><span class="nv">HTTP</span><span class="o">::</span>uri<span class="k">]]</span>

<span class="w">    </span><span class="nv">node</span><span class="w"> </span><span class="mf">1.1</span>.1.1<span class="w"> </span><span class="mi">443</span>
<span class="w">  </span><span class="k">}</span>
<span class="k">}</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/http_request_2.png"><img alt="_images/http_request_2.png" class="align-center" src="_images/http_request_2.png" style="width: 700px;" />
</a>
<a class="reference internal image-reference" href="_images/http_request_3.png"><img alt="_images/http_request_3.png" class="align-center" src="_images/http_request_3.png" style="width: 700px;" />
</a>
</section>
<section id="http-request-data">
<h2>HTTP_REQUEST_DATA<a class="headerlink" href="#http-request-data" title="Link to this heading">¶</a></h2>
<p>XC does not support HTTP Collect or streaming, so irules that rely heavily on this event will not be a good fit. However, you can do service chaining with NGINX in vk8s to carry out the end goal in some cases.</p>
</section>
<section id="http-response">
<h2>HTTP_RESPONSE<a class="headerlink" href="#http-response" title="Link to this heading">¶</a></h2>
<p>Like HTTP_REQUEST, this should be easily portable to L7 routes in XC.  For example:</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="nv">when</span><span class="w"> </span>HTTP_RESPONSE<span class="w"> </span><span class="k">{</span>
<span class="w">   </span><span class="nv">HTTP</span><span class="o">::</span>header<span class="w"> </span>insert<span class="w"> </span>Strict-Transport-Security<span class="w"> </span><span class="s2">&quot;max-age= 31536000&quot;</span>
<span class="w">   </span><span class="nv">HTTP</span><span class="o">::</span>header<span class="w"> </span>insert<span class="w"> </span><span class="s2">&quot;X-FRAME-OPTIONS&quot;</span><span class="w"> </span><span class="s2">&quot;SAMEORIGIN&quot;</span>
<span class="k">}</span>
</pre></div>
</div>
</section>
<section id="http-response-data">
<h2>HTTP_RESPONSE_DATA<a class="headerlink" href="#http-response-data" title="Link to this heading">¶</a></h2>
<p>XC does not support HTTP Collect or streaming, so irules that rely heavily on this event will not be a good fit. However, you can do service chaining with NGINX in vk8s to carry out the end goal in some cases.</p>
</section>
<section id="access-session-started-access-policy-agent-event-access-policy-completed-access-acl-denied-access-acl-allowed-rewrite-request-done-rewrite-response-done-access-session-closed">
<h2>ACCESS_SESSION_STARTED, ACCESS_POLICY_AGENT_EVENT, ACCESS_POLICY_COMPLETED, ACCESS_ACL_DENIED, ACCESS_ACL_ALLOWED, REWRITE_REQUEST_DONE, REWRITE_RESPONSE_DONE, ACCESS_SESSION_CLOSED<a class="headerlink" href="#access-session-started-access-policy-agent-event-access-policy-completed-access-acl-denied-access-acl-allowed-rewrite-request-done-rewrite-response-done-access-session-closed" title="Link to this heading">¶</a></h2>
<p>Since these are all APM iRules events, they are not supported in XC.  What we can do is evaluate incoming headers; MRH_Session, www-authenticate, etc., and make decisions on traffic.</p>
<p>An Example of filtering unauthenticated traffic would be to create a route and filter on Authorization Header exists, or 401 Error from Upstream, and then provide a custom error page:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/gh/dankogai/js-deflate/rawdeflate.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>SAMLAuthnRequest Test<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
    To use, modify the following variables:
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>var consumer = window.location.href; //Service Provider<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>var destination = &#39;https://sso.domain.com/login&#39;; //Identity Provider <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>var issuer = &#39;https://sso.domain.com&#39;; //Identity Provider<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    Todo:
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>-what else?<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;login&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;SAMLRequest&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;SAMLRequest&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;setAssertion()&quot;</span><span class="p">&gt;</span>Logon<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">consumer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span><span class="w">                </span><span class="c1">//Service Provider</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;https://sso.domain.com/login&#39;</span><span class="p">;</span><span class="w">   </span><span class="c1">//Identity Provider</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">issuer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;https://sso.domain.com&#39;</span><span class="p">;</span><span class="w">             </span><span class="c1">//Identity Provider</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span>
<span class="sb">        &#39;&lt;samlp:AuthnRequest xmlns:samlp=&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot; xmlns:saml=&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot; ID=&quot;&quot; Version=&quot;2.0&quot; ProviderName=&quot;XC SP&quot; IssueInstant=&quot;2014-07-16T23:52:45Z&quot;</span>
<span class="sb">        Destination=&quot;</span><span class="si">${</span><span class="nx">destination</span><span class="si">}</span><span class="sb">&quot; ProtocolBinding=&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST&quot;</span>
<span class="sb">        AssertionConsumerServiceURL=&quot;</span><span class="si">${</span><span class="nx">consumer</span><span class="si">}</span><span class="sb">&quot;&gt;</span>
<span class="sb">        &lt;saml:Issuer&gt;</span><span class="si">${</span><span class="nx">issuer</span><span class="si">}</span><span class="sb">&lt;/saml:Issuer&gt;</span>
<span class="sb">        &lt;samlp:NameIDPolicy Format=&quot;urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress&quot; AllowCreate=&quot;true&quot; /&gt;</span>
<span class="sb">        &lt;samlp:RequestedAuthnContext Comparison=&quot;exact&quot;&gt;</span>
<span class="sb">        &lt;saml:AuthnContextClassRef&gt;urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport&lt;/saml:AuthnContextClassRef&gt;</span>
<span class="sb">        &lt;/samlp:RequestedAuthnContext&gt;</span>
<span class="sb">        &lt;/samlp:AuthnRequest&gt;&#39;</span>
<span class="sb">        `</span><span class="p">;</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">deflatedTemplate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RawDeflate</span><span class="p">.</span><span class="nx">deflate</span><span class="p">(</span><span class="nx">template</span><span class="p">);</span>
<span class="w">            </span><span class="c1">//var encodedTemplate = btoa(template);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">encodedTemplate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">btoa</span><span class="p">(</span><span class="nx">deflatedTemplate</span><span class="p">);</span>
<span class="w">            </span><span class="kd">function</span><span class="w"> </span><span class="nx">setAssertion</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;SAMLRequest&quot;</span><span class="p">).</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">encodedTemplate</span><span class="p">);</span>
<span class="w">                </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;login&quot;</span><span class="p">).</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">issuer</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
<section id="logging">
<h2>Logging<a class="headerlink" href="#logging" title="Link to this heading">¶</a></h2>
<p>Many customers use iRules to add more values to logs. With XC, many of the standard values are captured as part of the request and security logs by default.</p>
<p>XC will automatically log telemetry data on platform, and can be connected to a SIEM via a Local (SYSLOG) or Global Log Reciever (JSON/HEC).
<a class="reference external" href="https://docs.cloud.f5.com/docs/how-to/others/global-log-streaming">https://docs.cloud.f5.com/docs/how-to/others/global-log-streaming</a></p>
<p>Let’s look at an example that captures SSL Cipher and Version:</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="nv">when</span><span class="w"> </span>CLIENTSSL_HANDSHAKE<span class="w"> </span><span class="k">{</span>
<span class="w">   </span><span class="c"># Identify the Client and negotiated cipher.</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="k">{</span><span class="nv">$static::payload_dbg</span><span class="k">}{</span><span class="nv">log</span><span class="w"> </span>local0.debug<span class="w"> </span><span class="s2">&quot;Connection from Client: [IP::client_addr] with Cipher: [SSL::cipher name] and SSL Version: [SSL::cipher version]&quot;</span><span class="k">}</span>
<span class="k">}</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/picture16.png"><img alt="_images/picture16.png" class="align-center" src="_images/picture16.png" style="width: 700px;" />
</a>
<p>Another example that is common is logging all headers, which is another default in XC.  I have seen many variations of the following irule:</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="nv">when</span><span class="w"> </span>HTTP_REQUEST<span class="w"> </span><span class="k">{</span>
<span class="w">   </span><span class="k">set</span><span class="w"> </span>LogString<span class="w"> </span><span class="s2">&quot;Client [IP::client_addr]:[TCP::client_port] -&gt; [HTTP::host][HTTP::uri]&quot;</span>
<span class="w">   </span><span class="nv">log</span><span class="w"> </span>local0.<span class="w"> </span><span class="s2">&quot;REQUEST======================================&quot;</span>
<span class="w">   </span><span class="nv">log</span><span class="w"> </span>local0.<span class="w"> </span><span class="s2">&quot;$LogString (request)&quot;</span>
<span class="w">   </span><span class="k">foreach</span><span class="w"> </span>aHeader<span class="w"> </span><span class="k">[</span><span class="nv">HTTP</span><span class="o">::</span>header<span class="w"> </span>names<span class="k">]</span><span class="w"> </span><span class="k">{</span>
<span class="w">      </span><span class="nv">log</span><span class="w"> </span>local0.<span class="w"> </span><span class="s2">&quot;$aHeader: [HTTP::header value $aHeader]&quot;</span>
<span class="w">   </span><span class="k">}</span>

<span class="w">   </span><span class="nv">log</span><span class="w"> </span>local0.<span class="w"> </span><span class="s2">&quot;=============================================&quot;</span>
<span class="k">}</span>

<span class="nv">when</span><span class="w"> </span>HTTP_RESPONSE<span class="w"> </span><span class="k">{</span>
<span class="w">   </span><span class="nv">log</span><span class="w"> </span>local0.<span class="w"> </span><span class="s2">&quot;RESPONSE=====================================&quot;</span>
<span class="w">   </span><span class="nv">log</span><span class="w"> </span>local0.<span class="w"> </span><span class="s2">&quot;$LogString (response) - status: [HTTP::status]&quot;</span>
<span class="w">   </span><span class="k">foreach</span><span class="w"> </span>aHeader<span class="w"> </span><span class="k">[</span><span class="nv">HTTP</span><span class="o">::</span>header<span class="w"> </span>names<span class="k">]</span><span class="w"> </span><span class="k">{</span>
<span class="w">      </span><span class="nv">log</span><span class="w"> </span>local0.<span class="w"> </span><span class="s2">&quot;$aHeader: [HTTP::header value $aHeader]&quot;</span>
<span class="w">   </span><span class="k">}</span>

<span class="w">   </span><span class="nv">log</span><span class="w"> </span>local0.<span class="w"> </span><span class="s2">&quot;=============================================&quot;</span>
<span class="k">}</span>
</pre></div>
</div>
</section>
<section id="example-conversions-in-terraform">
<h2>Example Conversions in Terraform<a class="headerlink" href="#example-conversions-in-terraform" title="Link to this heading">¶</a></h2>
<p>Standard http to https redirects are a checkbox in the UI but are also remarkably simple in terraform.</p>
<p>Standard HTTP to HTTPS redirect: http_redirect = true</p>
<p>Custom Redirect based on Header: <a class="reference external" href="https://github.com/Mikej81/xc-app-services-tf/blob/main/xc/http_loadbalancer.tf#L180">https://github.com/Mikej81/xc-app-services-tf/blob/main/xc/http_loadbalancer.tf#L180</a></p>
<p>Path Rewrites:  <a class="reference external" href="https://github.com/Mikej81/xc-app-services-tf/blob/main/xc/http_loadbalancer.tf#L330">https://github.com/Mikej81/xc-app-services-tf/blob/main/xc/http_loadbalancer.tf#L330</a></p>
<p>Pool Selection Based on URI:  <a class="reference external" href="https://github.com/Mikej81/xc-app-services-tf/blob/main/xc/http_loadbalancer.tf#L412">https://github.com/Mikej81/xc-app-services-tf/blob/main/xc/http_loadbalancer.tf#L412</a></p>
</section>
</section>
<section id="customer-edge">
<h1>Customer Edge<a class="headerlink" href="#customer-edge" title="Link to this heading">¶</a></h1>
<p>A Customer Edge is a Replica of an F5 Distributed Cloud Regional Edge, on a customer site.  It will fit into almost any form factor
and will extend the F5 Global Fabric to the edge location for use in multi-cloud network and multi-cloud application use-cases.</p>
<section id="sizing">
<h2>Sizing<a class="headerlink" href="#sizing" title="Link to this heading">¶</a></h2>
<p>Customer Edge Sizing can be simple, or not simple. Same as a BIG-IP, does it need LTM, APM, ASM, AFM, etc? HA?  Is the CE going to be used for L3 Routing / Mesh services only?  Will it need to run security services?  Will it need to run compute?</p>
<p>A good primer on deployment models can be found at Matt Harmon’s article here:  <a class="reference external" href="https://community.f5.com/kb/technicalarticles/f5-distributed-cloud---customer-edge-site---deployment--routing-options/319435">https://community.f5.com/kb/technicalarticles/f5-distributed-cloud—customer-edge-site—deployment–routing-options/319435</a></p>
</section>
<section id="clustering-and-high-availability">
<h2>Clustering and High availability<a class="headerlink" href="#clustering-and-high-availability" title="Link to this heading">¶</a></h2>
<p>Customer Edge Clustering differs from BIG-IP in that it is based on Kubernetes, and requires different
architectures.</p>
<p>Similar to BIG-IP in VMWare or HyperV environments, there are a couple configs to be aware of.</p>
<section id="vrrp-in-a-hypervisor">
<h3>VRRP in a Hypervisor<a class="headerlink" href="#vrrp-in-a-hypervisor" title="Link to this heading">¶</a></h3>
<p>If you decide to enable VRRP for a cluster, the following should be evaluated to ensure multicast is properly enabled.</p>
<ul>
<li><p>You must set the virtual switch’s Forged Transmits and Promiscuous Mode settings to Accept. (These settings are
disabled by default). For information about enabling Promiscuous Mode and Forged Transmits on the virtual switch,
refer to the VMware knowledge base article listed in the Supplemental section or in the VMware documentation for
your specific VMware version. F5 recommends that hypervisor administrators be very conservative with regard to
interface usage after you enable promiscuous mode. All packets are mirrored to all interfaces in the same
portgroup or vSwitch on which promiscuous mode is enabled. For each interface in the vSwitch or portgroup,
an additional hypervisor CPU is required to copy these packets. This can lead to CPU exhaustion for the
hypervisor, even if an interface is uninitialized on the system.</p></li>
<li><p>Starting from VMware ESXI 6.7, Promiscuous Mode can be replaced by MAC Learning in a supported environment,
that is, Promiscuous Mode can be set to Reject when MAC Learning is enabled on the vSwitch on which Customer Edge
VM is part of that network. The MAC Learning feature is supported only on Distributed Virtual (DV) Port groups.</p></li>
<li><p>When configuring VRRP/Multicast for Customer Edge on Microsoft Hyper-V servers,
you will need to enable MAC address spoofing for the Customer Edge VMs in order for VRRP to work properly.</p></li>
<li><p>To verify multicast is enabled issue the following command from each node in the Customer Edge Cluster.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>execcli<span class="w"> </span>vifdump<span class="w"> </span>-i<span class="w"> </span><span class="m">15</span><span class="w"> </span>-nnve<span class="w"> </span>vrrp<span class="w"> </span>and<span class="w"> </span>not<span class="w"> </span>host<span class="w"> </span><span class="o">[</span>ip-of-ce-node<span class="o">]</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
</section>
<section id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading">¶</a></h1>
<p>In some cases, for troubleshooting, I can help to turn off XC Default Error Messages and allow errors directly from the Upstream.</p>
<section id="errors">
<h2>403 Errors<a class="headerlink" href="#errors" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>csrf_origin_mismatch</strong>: If CSRF is enabled we compare the value of origin header against a list of allowed domains.
If origin is not there WAF blocks the request. Check how the POST or PUT requests are being sent.</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>Is the Origin or Referer header set? else, a CSRF violation woud be seen.</p></li>
</ul>
</div></blockquote>
</section>
<section id="id6">
<h2>404 Errors<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>route_not_found</strong>: XC did not find a route or domain that matches current config. It is possible that there is no route match (misconfiguration).</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>SNI at Origin Server config is wrong.</p></li>
<li><p>The request fails because authority does not route match.</p></li>
<li><p>There is not match for host header www.example.com OR match condition in any of the route objects.</p></li>
<li><p>Requests to the LB’s CNAME with either the exact or wildcard domain names are allowed. Others are returned a 404.</p></li>
<li><p>An incoming request to a HTTP LB will be rejected with a 404 error and req_id if the incoming Host header does not match any of:
* The values configured under Domains
* The CNAME record value for the virtual host, e.g. ves-io-&lt;random-string&gt;.ac.vh.volterra.us</p></li>
</ul>
</div></blockquote>
</section>
<section id="id7">
<h2>408 Errors<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>rsp_code_details=request_overall_timeout</strong>: check if there is slow_ddos_mitigation with request_timeout configured.</p></li>
</ul>
</section>
<section id="id8">
<h2>503 Errors<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>cluster_not_found</strong>: XC did not find an endpoint to send upstream.</p>
<ul>
<li><p>It is possible that there was no route match (misconfiguration)</p></li>
<li><p>If using a k8s service as upstream, its possible the service name is wrong.</p></li>
</ul>
</li>
<li><p><strong>upstream_reset_before_response_started{connection}</strong>:</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>One common reason would be that the firewalls would not have allow listed Regional Edge public IPs, to reach upstream(s). <a class="reference external" href="https://docs.cloud.f5.com/docs/reference/network-cloud-ref">https://docs.cloud.f5.com/docs/reference/network-cloud-ref</a></p></li>
<li><p>Other common reason is related to connection failure after X amount of seconds the connection timeout. Try to increase the connection timeout at origin pool to a higher value
to overcome this.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p><strong>no_healthy_upstream</strong>: Health check on the origin pool has failed. Check health check config and the expected response codes, as well as allowed IPs.</p></li>
<li><p><strong>via_upstream</strong>: The upstream server has generated this error code. Analysis has to be done on the endpoint. Another recommendation in such cases is to take a pcap from
client to origin server and see the details of the request.</p></li>
<li><p><strong>remote_reset</strong>: Can happen if the server does not correctly work with the http(1.1 or 2). Curl to the endpoint directly and see what http version works for the request and
configure accordingly.</p></li>
<li><p><strong>upstream_reset_before_response_started {connection_failure, TLS_error, OPENSSL_internal, Connection_reset_by_peer}</strong>: If any TLS error is seen like this, it indicates a TLS
handshake failure.</p></li>
<li><p><strong>upstream_reset_before_response_started{connection_failure, TLS_error, OPENSSL_internal:WRONG_VERSION_NUMBER}</strong>: Check if SSL negotiation is working with the endpoint by doing a curl to the endpoint via https directly,
and ensure the proper version protocol is selected.</p></li>
<li><p><strong>upstream_reset_before_response_started{connection_failure, TLS_error, OPENSSL_internal:CERTIFICATE_VERIFY_FAILED}</strong>: The certificate offered by the server was validated and that validation failed.</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>In the Origin pool TLS config, skip the verification.</p></li>
<li><p>In the Origin pool TLS config, Use a custom CA list.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p><strong>upstream_reset_before_response_started{connection termination}</strong>: The upstream server is closing the connection.</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>It is possible that the upstream server is overloaded by the requests and unable to handle it. Check response time value.</p></li>
<li><p>It is possible that on the server, the http idle timeout can be lesser than the idle-timeout on the origin-pool. It is strongly recommended that the origin-pool idle-timeout be configured to be less than that on the server.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p><strong>upstream_reset_before_response_started{protocol_error}</strong>:</p>
<ul>
<li><p>Check if the http response headers from the origin-server have any invalid field names. Query to the origin-server directly via curl or something equivalent.
Usually indicates that XC is seeing an error in one of the http-headers of the response from the server. We would need to see the http-headers that the origin-server
is responding with to identify the issue.</p></li>
<li><p>In one of the scenarios, it was seen that the origin-server may have a total of more than 100 headers(mostly duplciate headers), which XC will treat as failure parsing
the response.</p></li>
</ul>
</li>
<li><p><strong>upstream_reset_before_response_started{connection_failure,delayed_connect_error:_111}</strong>: No TCP SYN-ACKs seen for the TCP connection attempts to the endpoints.</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>The time_to_last_downstream_tx_byte would usually show some x seconds, and the other time_to_last_* fields would be 0 in this case</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p><strong>upstream_reset_before_response_started{connection_termination}</strong>: This error is due to server closing the connection while connection pool is still active.</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>Match the connection idle timeout between XC origin pool and Server. [Keep XC origin pool idle timeout a few seconds lesser than than the server timeout].</p></li>
<li><p>Apply retry policy for 5xx error. Packet capture if the issue still persists after applying above config changes.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p><strong>upstream_reset_before_response_started{remote_refused_stream_reset}</strong>: This error currently requires a tcpdump to troubleshoot.</p></li>
</ul>
</section>
<section id="id9">
<h2>504 Errors<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>stream_idle_timeout</strong>: Origin server took more than the idle timeout configured to respond to the request.</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>Increase the idle timeout on the HTTP LB.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p><strong>upstream_response_timeout</strong>: Origin server took more time than the timeout configured on the route in the Loadbalancer.</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>Increase the timeout in the miscellaneous options of the route (default 30 seconds)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that this response code may be seen due to TCP Connection timeout towards the upstream. It will happen in cases where the route timeout has a lower value
than connection timeout configured on the upstream origin pool.</p>
</div>
</div></blockquote>
</section>
<section id="other-errors">
<h2>Other Errors<a class="headerlink" href="#other-errors" title="Link to this heading">¶</a></h2>
<ul>
<li><p>Refused to execute script from ‘<a class="reference external" href="https://exampl.com/Errors/GlobalExceptionHandler.aspx?aspxerrorpath=/WebResource.axd">https://exampl.com/Errors/GlobalExceptionHandler.aspx?aspxerrorpath=/WebResource.axd</a>’ because its MIME type (‘text/html’) is not executable, and strict MIME type checking is enabled.</p>
<p><a class="reference external" href="https://my.f5.com/manage/s/article/K98868401">https://my.f5.com/manage/s/article/K98868401</a></p>
<a class="reference internal image-reference" href="_images/picture19.png"><img alt="_images/picture19.png" class="align-center" src="_images/picture19.png" style="width: 700px;" />
</a>
</li>
</ul>
</section>
<section id="important-request-log-fields">
<h2>Important Request Log Fields<a class="headerlink" href="#important-request-log-fields" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>time_to_last_downstream_tx_byte</strong>: Interval between the first downstream byte received and the last downstream byte sent.</p></li>
<li><p><strong>time_to_first_downstream_tx_byte</strong>: Interval between the first downstream byte received and the first downstream byte sent.</p></li>
<li><p><strong>time_to_last_upstream_rx_byte</strong>: Interval between the first downstream byte received and the last upstream byte received</p></li>
<li><p><strong>time_to_first_upstream_rx_byte</strong>: Interval between the first downstream byte received and the first upstream byte received ( time it takes to start receiving a response)</p></li>
<li><p><strong>time_to_first_upstream_tx_byte</strong>: Interval between the first downstream byte received and the first upstream byte sent</p></li>
<li><p><strong>time_to_last_upstream_tx_byte</strong>: Interval between the first downstream byte received and the last upstream byte sent</p></li>
<li><p><strong>duration_with_data_tx_delay = time_to_last_downstream_tx_byte - time_to_first_upstream_tx_byte</strong>: Basically indicates how much “time” its inside XC LB to do processing of the request/response ( like eg WAF , API detection , service policy , Bot detection etc if enabled ) + time upstream spent to process</p></li>
<li><p><strong>duration_with_no_data_tx_delay = time_to_first_downstream_tx_byte - time_to_first_upstream_tx_byte</strong>: Similar to duration_with_data_tx_delay , except that reference is taken from the moment first byte is sent to client</p></li>
</ul>
</section>
</section>
<section id="terminology">
<h1>Terminology<a class="headerlink" href="#terminology" title="Link to this heading">¶</a></h1>
<ul class="simple">
<li><p>AWAF: Advanced Web Application Firewall</p></li>
<li><p>Downstream: Client Side Connection (Source)</p></li>
<li><p>SNAT: Source Network Address Translation</p></li>
<li><p>Upstream: Server Side Connection (Origin)</p></li>
<li><p>WAAP: Web Application &amp; API Protection</p></li>
<li><p>XC: F5 Distributed Cloud</p></li>
</ul>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
  <div>
    <h3><a href="#">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">BIG-IP To Distributed Cloud Conversion Frequently Asked Questions and Tips</a></li>
<li><a class="reference internal" href="#disclaimer">Disclaimer</a></li>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#contributing">Contributing</a></li>
<li><a class="reference internal" href="#disqualifiers">Disqualifiers</a></li>
<li><a class="reference internal" href="#tools">Tools</a></li>
<li><a class="reference internal" href="#access-policy-manager">Access Policy Manager</a></li>
<li><a class="reference internal" href="#awaf-to-waap">AWAF to WAAP</a><ul>
<li><a class="reference internal" href="#bot-defense">Bot Defense</a></li>
<li><a class="reference internal" href="#id4">Policy Supervisor</a></li>
</ul>
</li>
<li><a class="reference internal" href="#local-traffic-manager">Local Traffic Manager</a></li>
<li><a class="reference internal" href="#dns">DNS</a><ul>
<li><a class="reference internal" href="#big-ip-dns-pool-to-xc-dns-lb-pool">BIG-IP DNS Pool to XC DNS LB Pool</a></li>
<li><a class="reference internal" href="#big-ip-dns-wide-ip-to-xc-dns-lb-record">BIG-IP DNS Wide IP to XC DNS LB Record</a></li>
<li><a class="reference internal" href="#zonerunner-dnsexpress">Zonerunner &amp; DNSExpress</a></li>
</ul>
</li>
<li><a class="reference internal" href="#apm-to-distributed-cloud-service-chaining">APM to Distributed Cloud (Service Chaining)</a><ul>
<li><a class="reference internal" href="#api-security">API Security</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ltm-to-load-balancing-as-a-service">LTM to Load Balancing as a Service</a><ul>
<li><a class="reference internal" href="#tcp-option-28-and-proxy-protocol">TCP Option 28 and Proxy Protocol</a></li>
<li><a class="reference internal" href="#websockets">Websockets</a></li>
<li><a class="reference internal" href="#ltm-as-upstream-origin">LTM as Upstream / Origin</a><ul>
<li><a class="reference internal" href="#http-1-1-http-2">HTTP/1.1 &amp; HTTP/2</a></li>
<li><a class="reference internal" href="#http-keep-alive-connection-headers">HTTP Keep-Alive &amp; Connection Headers</a></li>
<li><a class="reference internal" href="#monitors-to-health-checks">Monitors to Health Checks</a></li>
<li><a class="reference internal" href="#snat">SNAT</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ltm-to-customer-edge">LTM to Customer Edge</a></li>
<li><a class="reference internal" href="#snat-pooling">SNAT Pooling</a></li>
<li><a class="reference internal" href="#traffig-group-floating-self-ip">Traffig Group / Floating Self-IP</a></li>
<li><a class="reference internal" href="#custom-monitors">Custom Monitors</a></li>
</ul>
</li>
<li><a class="reference internal" href="#qkview-ihealth">QKView - iHealth</a><ul>
<li><a class="reference internal" href="#graphs">Graphs</a><ul>
<li><a class="reference internal" href="#ssl-transactions">SSL Transactions</a></li>
<li><a class="reference internal" href="#tmm-client-side-throughput">TMM Client-Side Throughput</a></li>
<li><a class="reference internal" href="#tmm-server-side-throughput">TMM Server-Side Throughput</a></li>
<li><a class="reference internal" href="#throughput">Throughput</a></li>
</ul>
</li>
<li><a class="reference internal" href="#irules">iRules</a></li>
<li><a class="reference internal" href="#commands">Commands</a><ul>
<li><a class="reference internal" href="#list-ltm-virtual-all-properties">list /ltm virtual all-properties</a></li>
<li><a class="reference internal" href="#show-ltm-profile-http-global">show /ltm profile http global</a></li>
</ul>
</li>
<li><a class="reference internal" href="#unix-tmos-tmctl-a-blade">UNIX - TMOS - tmctl -a (blade)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5">iRules</a><ul>
<li><a class="reference internal" href="#rule-init">RULE_INIT</a></li>
<li><a class="reference internal" href="#client-accepted">CLIENT_ACCEPTED</a></li>
<li><a class="reference internal" href="#clientssl-clientcert">CLIENTSSL_CLIENTCERT</a></li>
<li><a class="reference internal" href="#lb-selected-lb-failed">LB_SELECTED &amp; LB_FAILED</a></li>
<li><a class="reference internal" href="#http-request">HTTP_REQUEST</a></li>
<li><a class="reference internal" href="#http-request-data">HTTP_REQUEST_DATA</a></li>
<li><a class="reference internal" href="#http-response">HTTP_RESPONSE</a></li>
<li><a class="reference internal" href="#http-response-data">HTTP_RESPONSE_DATA</a></li>
<li><a class="reference internal" href="#access-session-started-access-policy-agent-event-access-policy-completed-access-acl-denied-access-acl-allowed-rewrite-request-done-rewrite-response-done-access-session-closed">ACCESS_SESSION_STARTED, ACCESS_POLICY_AGENT_EVENT, ACCESS_POLICY_COMPLETED, ACCESS_ACL_DENIED, ACCESS_ACL_ALLOWED, REWRITE_REQUEST_DONE, REWRITE_RESPONSE_DONE, ACCESS_SESSION_CLOSED</a></li>
<li><a class="reference internal" href="#logging">Logging</a></li>
<li><a class="reference internal" href="#example-conversions-in-terraform">Example Conversions in Terraform</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customer-edge">Customer Edge</a><ul>
<li><a class="reference internal" href="#sizing">Sizing</a></li>
<li><a class="reference internal" href="#clustering-and-high-availability">Clustering and High availability</a><ul>
<li><a class="reference internal" href="#vrrp-in-a-hypervisor">VRRP in a Hypervisor</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li><a class="reference internal" href="#errors">403 Errors</a></li>
<li><a class="reference internal" href="#id6">404 Errors</a></li>
<li><a class="reference internal" href="#id7">408 Errors</a></li>
<li><a class="reference internal" href="#id8">503 Errors</a></li>
<li><a class="reference internal" href="#id9">504 Errors</a></li>
<li><a class="reference internal" href="#other-errors">Other Errors</a></li>
<li><a class="reference internal" href="#important-request-log-fields">Important Request Log Fields</a></li>
</ul>
</li>
<li><a class="reference internal" href="#terminology">Terminology</a></li>
</ul>

  </div>
<h3><a href="#">Table of Contents</a></h3>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="#">BIG-IP to XC 2024 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">BIG-IP To Distributed Cloud Conversion Frequently Asked Questions and Tips</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, Michael Coleman.
      Last updated on 2024-06-07 14:13:39.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    </div>
  </body>
</html>